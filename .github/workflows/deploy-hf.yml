name: Deploy to Hugging Face Spaces

on:
  push:
    branches: [main, master]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Frontend (this repo)
        uses: actions/checkout@v4
        with:
          path: frontend

      - name: Checkout Backend
        uses: actions/checkout@v4
        with:
          repository: mouniksai/vote-guard-server
          path: frontend/vote-guard-server
          token: ${{ secrets.GH_PAT }}

      - name: Remove nested .git
        run: rm -rf frontend/vote-guard-server/.git

      - name: Push to Hugging Face Space
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
          HF_SPACE: ${{ secrets.HF_SPACE_NAME }}
        run: |
          cd frontend
          git config user.email "ci@voteguard.com"
          git config user.name "VoteGuard CI"
          git add -A
          git commit -m "Deploy: frontend + backend ($(date '+%Y-%m-%d %H:%M'))" --allow-empty
          git push --force https://USER:${HF_TOKEN}@huggingface.co/spaces/${HF_SPACE} HEAD:main
